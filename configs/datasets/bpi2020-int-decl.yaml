# BPI Challenge 2020 — International Declarations
# 6,449 cases, 72,151 events
# Intervention: Send Reminder (sending a payment reminder)
# Positive outcome: Payment Handled

dataset_name: "bpi2020-int-decl"

data:
  format: xes
  raw_path: "data/raw/bpi2020-international-declarations.xes.gz"
  output_clean_path: "data/{dataset_name}/interim/clean.parquet"

# XES standard column names as produced by pm4py.convert_to_dataframe()
schema:
  case_id: "case:concept:name"
  activity: "concept:name"
  timestamp: "time:timestamp"

time:
  timezone: null          # pm4py returns timezone-aware timestamps
  output_timezone: "UTC"  # normalize to UTC
  sort: true
  drop_duplicates: false

preprocess:
  out_clean_parquet: "clean.parquet"
  lifecycle_filter:
    enabled: false  # BPI2020 int-decl does not have lifecycle:transition events
  # Keep only essential columns (XES logs have many extra case:* attributes)
  select_cols: ["case_id", "activity", "timestamp"]

outcome_engineering:
  enabled: true
  type: "activity_presence"
  positive_activities: ["Payment Handled"]
  outcome_col: "outcome"

validation_split:
  range_checks:
    enabled: false

# BPI2020 int-decl: 45k train transitions. 50k steps ≈ 140 epochs at batch_size=128.
training:
  max_steps: 50000
  eval_every: 2000
  save_every: 10000

mdp:
  behavior_trigger_activity: "Send Reminder"
  decision_points:
    mode: "all"
  actions:
    id2name: ["do_nothing", "Send Reminder"]
    noop_action: "do_nothing"
  action_mask:
    default_valid: ["do_nothing", "Send Reminder"]
  reward:
    type: "terminal_profit_delayed"
    intermediate_reward: 0.0
    terminal_column: "outcome"
  output:
    path: "data/{dataset_name}/processed/D_offline.npz"

experiment:
  checkpoint_path: "artifacts/models/tdqn/20260223_114505/Q_theta.ckpt"
  ope_report_path: "artifacts/ope/{dataset_name}/ope_dr.json"

xai:
  checkpoint_path: "artifacts/models/tdqn/20260223_114505/Q_theta.ckpt"
  out_dir: "xai/{dataset_name}"

fidelity:
  out_csv: "artifacts/fidelity/{dataset_name}/fidelity.csv"

distill:
  teacher_checkpoint: "artifacts/models/tdqn/20260223_114505/Q_theta.ckpt"
  out_dir: "artifacts/distill/{dataset_name}"
